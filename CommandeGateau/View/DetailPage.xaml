<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:model="clr-namespace:CommandeGateau.Models"
             xmlns:viewmodel="clr-namespace:CommandeGateau.ViewModel"
             x:Class="CommandeGateau.View.DetailPage"
             x:DataType="viewmodel:DetailViewModel"
             Title="Détails de la commande"
             BackgroundColor="White">

    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="15">
                <Label Text="Nom du client :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.NameClient}" />

                <Label Text="Nom :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.Name}" />

                <Label Text="Âge :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.Age}" />

                <Label Text="Date de livraison :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.DateLivraison, StringFormat='{0:dd/MM/yyyy}'}" />

                <Label Text="Note :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.Note}" />

                <Label Text="Total :" FontAttributes="Bold" />
                <Label Text="{Binding Commande.Total, StringFormat='{0:F2} €'}" />

                <Label Text="Pâtisseries :" FontAttributes="Bold" FontSize="18" />

                <HorizontalStackLayout IsVisible="{Binding IsFromArchive, Converter={StaticResource InverseBoolConverter}}" >
                    <Button 
                        Text="Modifier" 
                        Command="{Binding ToggleEditPatisseriesCommand}" 
                        IsVisible="{Binding IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}" />
                    <Button 
                        Text="Terminer" 
                        Command="{Binding ConfirmEditPatisseriesCommand}" 
                        IsVisible="{Binding IsEditingPatisseries}" />
                </HorizontalStackLayout>

                <CollectionView ItemsSource="{Binding Patisseries}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="model:PatisserieTemplate">
                            <Border BackgroundColor="#F9F9F9"
                                    Padding="10"
                                    Margin="0,5"
                                    Stroke="#DDD"
                                    StrokeThickness="1"
                                    StrokeShape="RoundRectangle 15">
                                <VerticalStackLayout Spacing="5">

                                    <Label Text="{Binding PatisserieType}" FontAttributes="Bold" />

                                    <Grid ColumnDefinitions="Auto,*">
                                        <Label Text="Thème : " VerticalOptions="Center"/>
                                        <Entry Grid.Column="1" 
                                            Text="{Binding Name, Mode=TwoWay}" 
                                            Placeholder="Thème"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries}"
                                            VerticalOptions="Center"/>
                                        <Label Grid.Column="1" 
                                            Text="{Binding Name}"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                            VerticalOptions="Center"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="Auto,*">
                                        <Label Text="Quantité : " VerticalOptions="Center"/>
                                        <Entry Grid.Column="1"
                                               Text="{Binding Quantity, Mode=TwoWay}" 
                                               Keyboard="Numeric"
                                               IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries}"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Column="1"
                                               Text="{Binding Quantity}"
                                               IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                               VerticalOptions="Center"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="Auto,*">
                                        <Label Text="Prix unitaire : " VerticalOptions="Center" IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"/>
                                        <Label Grid.Column="1" 
                                               Text="{Binding Price, StringFormat='{0:F2} €'}"
                                               IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                               VerticalOptions="Center"/>
                                    </Grid>

                                    <VerticalStackLayout IsVisible="False" Spacing="5">
                                        <VerticalStackLayout.Triggers>
                                            <DataTrigger TargetType="VerticalStackLayout"
                                                         Binding="{Binding PatisserieType}"
                                                         Value="Gateau">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                        </VerticalStackLayout.Triggers>

                                        <Grid ColumnDefinitions="Auto,*">
                                            <Label Text="Étages : " VerticalOptions="Center"/>
                                            <Entry Grid.Column="1"
                                                   Text="{Binding Etage, Mode=TwoWay}"
                                                   Keyboard="Numeric"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries}"
                                                   VerticalOptions="Center"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Etage}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                        <Grid ColumnDefinitions="Auto,*">
                                            <Label Text="Goût : " VerticalOptions="Center"/>
                                            <Entry Grid.Column="1"
                                                   Text="{Binding Gout, Mode=TwoWay}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries}"
                                                   VerticalOptions="Center"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Gout}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                        <Grid ColumnDefinitions="Auto,*">
                                            <Label Text="Fruité : " VerticalOptions="Center" IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Fruite, Converter={StaticResource BoolToOuiNonConverter}}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                        <Grid ColumnDefinitions="Auto,*">
                                            <Label Text="Modelage : " VerticalOptions="Center" IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Modelage, Converter={StaticResource BoolToOuiNonConverter}}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout IsVisible="False">
                                        <VerticalStackLayout.Triggers>
                                            <DataTrigger TargetType="VerticalStackLayout"
                                                         Binding="{Binding PatisserieType}"
                                                         Value="Biscuit">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                        </VerticalStackLayout.Triggers>
                                        <Grid ColumnDefinitions="Auto,*">
                                            <Label Text="Grand format : " VerticalOptions="Center" IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding Taille, Converter={StaticResource BoolToOuiNonConverter}}"
                                                   IsVisible="{Binding Source={RelativeSource AncestorType={x:Type viewmodel:DetailViewModel}}, Path=IsEditingPatisseries, Converter={StaticResource InverseBoolConverter}}"
                                                   VerticalOptions="Center"/>
                                        </Grid>
                                    </VerticalStackLayout>

                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>

        <ImageButton Source="delete.png"
             WidthRequest="24"
             HeightRequest="24"
             BackgroundColor="Transparent"
             HorizontalOptions="End"
             VerticalOptions="Start"
             Margin="0,10,10,0"
             Command="{Binding DeleteCommandeCommand}"
             IsVisible="{Binding IsFromArchive, Converter={StaticResource InverseBoolConverter}}" />

        <ImageButton Source="confirm.png"
             WidthRequest="24"
             HeightRequest="24"
             BackgroundColor="Transparent"
             HorizontalOptions="End"
             VerticalOptions="Start"
             Margin="0,60,10,0"
             Command="{Binding ArchiveCommandeCommand}"
             IsVisible="{Binding IsFromArchive, Converter={StaticResource InverseBoolConverter}}" />

        <ImageButton Source="delete.png"
             WidthRequest="24"
             HeightRequest="24"
             BackgroundColor="Transparent"
             HorizontalOptions="End"
             VerticalOptions="Start"
             Margin="0,10,10,0"
             Command="{Binding DeleteArchiveCommand}"
             IsVisible="{Binding IsNotFromArchive, Converter={StaticResource InverseBoolConverter}}" />

    </Grid>
</ContentPage>
